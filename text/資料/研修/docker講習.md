# フロントの人が知っておくべきコンテナ技術

## 日時
- 2020/10/27
- 11時〜


## 概要
2020年ポピュラーなサーバー管理技術

## 目次
- コンテナとDocker。メリットやその必要性
- Webアプリを例に実際にコンテナの例
- Docker基礎
- ディスカッション

## コンテナとDocker。メリットやその必要性

コンテナ
- アプリケーションやそのミドルウェアなどをパッケージ化する技術（考え方）
- コンテナが動く環境ならどこでもアプリケーションが動作する
- 仮想サーバー（Virtual Machine）と似ているが技術的に全く別物

Docker
- 上記のコンテナの実装の一つ
- 現在最もメジャーな実装（デファクトスタンダード）
- まずはこれを覚えましょう

アプリケーションを正しく配置するため
- 近年のアプリケーションは多くの外部ライターに依存している
	- npmとか
- ミドルウェアにも依存している
	- PHPのバージョン違いとか
- 様々な外部サービスにも依存している（DB, キャッシュ, CDN etc…）
- プロジェクトの環境も複数ある（Testing, Staging, Production）
→依存関係を間違えるとアプリケーションの動作に大きな影響がある　
　（動かなくなる）

コンテナがアプリケーションの動作を保証しやすい
- コンテナ内にはアプリケーションとミドルウェアが含まれている
	- 依存関係が内部で完結している
- どこでもアプリを動かす事ができる
	- コンテナをそのまま他の場所へ移せばすぐに動作させられる
→アプリケーションの環境依存を減らすことができ、開発や運用の効率を上げられる　

コンテナ自体はすでに開発のメインストリーム
- インフラの技術はすでにアプリのコンテナ化を前提にしたものが増えている
- ビルドやCIシステムも同じ
- 今はフロントの人でもガンガンコマンドを叩く
- JS界隈の人のほうがむしろDocker好きな気がする（依存が多いので）

## 実際のコンテナ
具体的にコンテナとは何なのか
- アプリケーションの実行に必要なファイルをまとめたもの
- 例えばPHPのWebアプリの場合、PHPファイル、アセットファイル（js, css）、画像ファイルなど

アプリケーションのファイルだけではない
- Webアプリを動作させるには実行環境も必要
	- N+、PHP、　MySQLなど

コンテナにはWebアプリ部分と実行環境を含む
（ホストOSをふくまない）

Dockerはwin, macOS, Linuxなどにインストールできる
Dockerがインストールされていればどの環境でもコンテナが動く
- そのコンテナを動作させるものをコンテナランタイムと呼ぶ
- Dockerはコンテナランタイムの一つ
- コンテナにはWebアプリを実行するために必要なものが全て含まれている　
- 実運用では複数コンテナが連携してシステムを構成する
- 一つのコンテナに一つの機能を割り当てる
	- Webサーバ⇔Webアプリ＋実行環境⇔データベース

開発環境としてDockerを使うのも全然あり
- VSCodeの**Remote Development**
- コンテナ内に開発環境を作る
- ローカルに開発環境を作る必要がない
- VSCodeが（ある程度）自動でやってくれる
- マシンが変わってもOK

まとめ
- コンテナがアプリケーションとその実行環境をパッケージにしたもの
- Dockerとはコンテナを動作させるランタイムの有名な実装の一つ
- 近年のアプリケーションは多くの依存関係をシンプルにできる
- それにより開発や運用の効率を上げることができる

FAQ
- VSCodeのRemote Developmentってリモートに保存みたいな？
	- ローカルに保存。マシンを変更する場合はコンテナを移動させる
	- VPS上に上げても良い（エディターはローカル）
	- ファイルを保存するときだけ通信が発火する（文字うち、カーソル移動はローカル）


## ハンズオン
Docker Pull
- コンテナイメージのダウンロード
- オフィシャルのリポジトリがデフォルトのダウンロード先
- (FAQ)ローカルからPullできる？←ローカルにある場合は必要ない
	- ローカルの環境をDockerに乗せられる？
	- ↑自分で作ったリポジトリ（オフィシャル以外）も使用できる
- 商材なら個別で作ったリポジトリをアップ→本番環境でりぽじとりを参照？
どうなってるか
- ローカル>creative_vm>docker
Dockerのimageを動かす
- docker run -ti --rm centos /bin/bash
- これでコンテナが実行される
- Vagrantからcentosの環境に入れた
- ダウンロードのあとはすぐにcentosに入れる

## ディスカッション
- クリエイティブのフロントの開発は主にPHPファイルとアセット（js，css, image）
- サーバーの適切なフォルダにアップロードすれば動いていた
- DBなど環境に応じて設定を切りわける必要があるけどノウハウがあるので無問題
- わざわざコンテナやDockerにする必要性を感じない
- コンテナはイメージ作るのが複雑で、CI回るの時間かかるし、ライブアップ遅い
	- チェックが遅い
	- あと毎回ビルドが走ってるため遅い
	- 現在ベースイメージを固めてるので現在高速化中　
	- 多少は早くなるけどお名前はでかすぎてメモリが足りない
- バックエンドを意識しないで作業できていたのが良かったのに変わるの？
- コンテナ化は「考えなきゃいけないことが増えただけ」
- 結局コンテナのメリットってあるの？
